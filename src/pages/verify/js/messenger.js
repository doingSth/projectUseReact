!function(){function Target(target,name){var errMsg="";if(arguments.length<2?errMsg="target error - target and name are both requied":"object"!=typeof target?errMsg="target error - target itself must be window object":"string"!=typeof name&&(errMsg="target error - target name must be string type"),errMsg)throw new Error(errMsg);this.target=target,this.name=name}function Messenger(name){this.targets={},this.name=name,this.listenFunc=[],this.initListen()}var prefix="[VERIFY_CODE]",supportPostMessage="postMessage"in window;supportPostMessage?Target.prototype.send=function(msg){this.target.postMessage(prefix+msg,"*")}:Target.prototype.send=function(msg){var targetFunc=window.navigator[prefix+this.name];if("function"!=typeof targetFunc)throw new Error("target callback function is not defined");targetFunc(prefix+msg,window)},Messenger.prototype.addTarget=function(target,name){var targetObj=new Target(target,name);this.targets[name]=targetObj},Messenger.prototype.initListen=function(){var self=this,generalCallback=function(msg){"object"==typeof msg&&msg.data&&(msg=msg.data),msg=msg.slice(prefix.length);for(var i=0;i<self.listenFunc.length;i++)self.listenFunc[i](msg)};supportPostMessage?"addEventListener"in document?window.addEventListener("message",generalCallback,!1):"attachEvent"in document&&window.attachEvent("onmessage",generalCallback):window.navigator[prefix+this.name]=generalCallback,this.generalCallback=generalCallback},Messenger.prototype.listen=function(callback){this.listenFunc.push(callback)},Messenger.prototype.send=function(msg){var targets=this.targets,target;for(target in targets)targets.hasOwnProperty(target)&&targets[target].send(msg)},Messenger.prototype.destroy=function(){"addEventListener"in document?window.removeEventListener("message",this.generalCallback,!1):"attachEvent"in document&&window.detachEvent("onmessage",this.generalCallback)},window.Messenger=Messenger}();